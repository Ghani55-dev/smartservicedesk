{% extends 'core/base.html' %}
{% block content %}
{% if messages %}
  <div>
    {% for message in messages %}
      <div class="p-3 mb-4 rounded {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-400{% elif message.tags == 'error' %}bg-red-100 text-red-800 border border-red-400{% else %}bg-blue-100 text-blue-800 border border-blue-400{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<div class="max-w-3xl mx-auto bg-white shadow-lg rounded-lg p-6">

    <!-- Title -->
    <h2 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">🎫 Ticket: {{ ticket.title }}</h2>

    <!-- Ticket Details -->
    <div class="space-y-2 text-gray-700 mb-6">
        <p><span class="font-semibold">📝 Description:</span> {{ ticket.description }}</p>
        <p><span class="font-semibold">📌 Status:</span> 
            <span class="inline-block px-2 py-1 rounded-full text-sm 
                {% if ticket.status == 'Open' %} bg-yellow-100 text-yellow-800 
                {% elif ticket.status == 'In Progress' %} bg-blue-100 text-blue-800 
                {% elif ticket.status == 'Resolved' %} bg-green-100 text-green-800 
                {% elif ticket.status == 'Closed' %} bg-gray-300 text-gray-700 
                {% endif %}">
                {{ ticket.status }}
            </span>
        </p>
        <p><span class="font-semibold">🚩 Priority:</span> {{ ticket.priority }}</p>
        <p><span class="font-semibold">👤 Created By:</span> {{ ticket.created_by }}</p>
        <p><span class="font-semibold">👨‍💼 Assigned To:</span> {{ ticket.assigned_to|default:"Not Assigned" }}</p>
    </div>

    <!-- Assign Ticket (Admin) -->
    {% if assign_form %}
    <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Assign to Agent</h3>
        <form method="post">
            {% csrf_token %}
            <div class="space-y-2">
                {{ assign_form.as_p }}
            </div>
            <button type="submit" name="assign"
                class="mt-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow">
                ✅ Assign Ticket
            </button>
        </form>
    </div>
    {% endif %}

    <!-- Update Status (Agent) -->
    {% if status_form %}
    <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Update Status</h3>
        <form method="post">
            {% csrf_token %}
            <div class="space-y-2">
                {{ status_form.as_p }}
            </div>
            <button type="submit" name="status"
                class="mt-3 bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded shadow">
                🔄 Update Status
            </button>
        </form>
    </div>
    {% endif %}

    <!-- Back Link -->
    <div class="text-right">
        <a href="{% url 'ticket_list' %}"
            class="inline-block text-sm text-blue-600 hover:underline mt-4">← Back to Tickets</a>
    </div>

</div>
{% endblock %}
